var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,a=(t,n,o)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,u=(e,t)=>{for(var n in t||(t={}))r.call(t,n)&&a(e,n,t[n]);if(o)for(var n of o(t))s.call(t,n)&&a(e,n,t[n]);return e},c=(e,o)=>t(e,n(o));import{o as d,b as i,a as l,bD as f,bk as v,U as p,_ as m,d as E,j as b,a5 as y,u as w,ag as h,n as L,a9 as T,a6 as g,a0 as P,ah as O,G as k,f as F,ay as j,an as R}from"./index-IQGo8WxO.js";import{i as S}from"./aria-BWz5Vf1b.js";const _="focus-trap.focus-after-trapped",x="focus-trap.focus-after-released",K={cancelable:!0,bubbles:!1},N={cancelable:!0,bubbles:!1},I="focusAfterTrapped",A="focusAfterReleased",C=Symbol("elFocusTrap"),D=l(),q=l(0),B=l(0);let U=0;const $=e=>{const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0||e===document.activeElement?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t},H=(e,t)=>{for(const n of e)if(!M(n,t))return n},M=(e,t)=>{if("hidden"===getComputedStyle(e).visibility)return!0;for(;e;){if(t&&e===t)return!1;if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1},W=(e,t)=>{if(e&&e.focus){const n=document.activeElement;let o=!1;!f(e)||S(e)||e.getAttribute("tabindex")||(e.setAttribute("tabindex","-1"),o=!0),e.focus({preventScroll:!0}),B.value=window.performance.now(),e!==n&&(e=>e instanceof HTMLInputElement&&"select"in e)(e)&&t&&e.select(),f(e)&&o&&e.removeAttribute("tabindex")}};function G(e,t){const n=[...e],o=e.indexOf(t);return-1!==o&&n.splice(o,1),n}const z=(()=>{let e=[];return{push:t=>{const n=e[0];n&&t!==n&&n.pause(),e=G(e,t),e.unshift(t)},remove:t=>{var n,o;e=G(e,t),null==(o=null==(n=e[0])?void 0:n.resume)||o.call(n)}}})(),J=()=>{D.value="pointer",q.value=window.performance.now()},Q=()=>{D.value="keyboard",q.value=window.performance.now()},V=e=>new CustomEvent("focus-trap.focusout-prevented",c(u({},N),{detail:e}));let X=[];const Y=e=>{e.code===p.esc&&X.forEach((t=>t(e)))};var Z=m(E({name:"ElFocusTrap",inheritAttrs:!1,props:{loop:Boolean,trapped:Boolean,focusTrapEl:Object,focusStartEl:{type:[Object,String],default:"first"}},emits:[I,A,"focusin","focusout","focusout-prevented","release-requested"],setup(e,{emit:t}){const n=l();let o,r;const{focusReason:s}=(d((()=>{0===U&&(document.addEventListener("mousedown",J),document.addEventListener("touchstart",J),document.addEventListener("keydown",Q)),U++})),i((()=>{U--,U<=0&&(document.removeEventListener("mousedown",J),document.removeEventListener("touchstart",J),document.removeEventListener("keydown",Q))})),{focusReason:D,lastUserFocusTimestamp:q,lastAutomatedFocusTimestamp:B});var a;a=n=>{e.trapped&&!f.paused&&t("release-requested",n)},d((()=>{0===X.length&&document.addEventListener("keydown",Y),v&&X.push(a)})),i((()=>{X=X.filter((e=>e!==a)),0===X.length&&v&&document.removeEventListener("keydown",Y)}));const f={paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}},m=n=>{if(!e.loop&&!e.trapped)return;if(f.paused)return;const{code:o,altKey:r,ctrlKey:a,metaKey:u,currentTarget:c,shiftKey:d}=n,{loop:i}=e,l=o===p.tab&&!r&&!a&&!u,v=document.activeElement;if(l&&v){const e=c,[o,r]=(e=>{const t=$(e);return[H(t,e),H(t.reverse(),e)]})(e);if(o&&r)if(d||v!==r){if(d&&[o,e].includes(v)){const e=V({focusReason:s.value});t("focusout-prevented",e),e.defaultPrevented||(n.preventDefault(),i&&W(r,!0))}}else{const e=V({focusReason:s.value});t("focusout-prevented",e),e.defaultPrevented||(n.preventDefault(),i&&W(o,!0))}else if(v===e){const e=V({focusReason:s.value});t("focusout-prevented",e),e.defaultPrevented||n.preventDefault()}}};g(C,{focusTrapRef:n,onKeydown:m}),y((()=>e.focusTrapEl),(e=>{e&&(n.value=e)}),{immediate:!0}),y([n],(([e],[t])=>{e&&(e.addEventListener("keydown",m),e.addEventListener("focusin",P),e.addEventListener("focusout",O)),t&&(t.removeEventListener("keydown",m),t.removeEventListener("focusin",P),t.removeEventListener("focusout",O))}));const E=e=>{t(I,e)},b=e=>t(A,e),P=s=>{const a=w(n);if(!a)return;const u=s.target,c=s.relatedTarget,d=u&&a.contains(u);if(!e.trapped){c&&a.contains(c)||(o=c)}d&&t("focusin",s),f.paused||e.trapped&&(d?r=u:W(r,!0))},O=o=>{const a=w(n);if(!f.paused&&a)if(e.trapped){const n=o.relatedTarget;h(n)||a.contains(n)||setTimeout((()=>{if(!f.paused&&e.trapped){const e=V({focusReason:s.value});t("focusout-prevented",e),e.defaultPrevented||W(r,!0)}}),0)}else{const e=o.target;e&&a.contains(e)||t("focusout",o)}};function k(){return t=this,r=null,s=function*(){yield L();const t=w(n);if(t){z.push(f);const n=t.contains(document.activeElement)?o:document.activeElement;if(o=n,!t.contains(n)){const o=new Event(_,K);t.addEventListener(_,E),t.dispatchEvent(o),o.defaultPrevented||L((()=>{let o=e.focusStartEl;T(o)||(W(o),document.activeElement!==o&&(o="first")),"first"===o&&((e,t=!1)=>{const n=document.activeElement;for(const o of e)if(W(o,t),document.activeElement!==n)return})($(t),!0),document.activeElement!==n&&"container"!==o||W(t)}))}}},new Promise(((e,n)=>{var o=e=>{try{u(s.next(e))}catch(t){n(t)}},a=e=>{try{u(s.throw(e))}catch(t){n(t)}},u=t=>t.done?e(t.value):Promise.resolve(t.value).then(o,a);u((s=s.apply(t,r)).next())}));var t,r,s}function F(){const e=w(n);if(e){e.removeEventListener(_,E);const t=new CustomEvent(x,c(u({},K),{detail:{focusReason:s.value}}));e.addEventListener(x,b),e.dispatchEvent(t),t.defaultPrevented||"keyboard"!=s.value&&q.value>B.value&&!e.contains(document.activeElement)||W(null!=o?o:document.body),e.removeEventListener(x,b),z.remove(f)}}return d((()=>{e.trapped&&k(),y((()=>e.trapped),(e=>{e?k():F()}))})),i((()=>{e.trapped&&F(),n.value&&(n.value.removeEventListener("keydown",m),n.value.removeEventListener("focusin",P),n.value.removeEventListener("focusout",O),n.value=void 0)})),{onKeydown:m}}}),[["render",function(e,t,n,o,r,s){return b(e.$slots,"default",{handleKeydown:e.onKeydown})}],["__file","focus-trap.vue"]]);const ee=P({to:{type:O([String,Object]),required:!0},disabled:Boolean});const te=R(m(E({__name:"teleport",props:ee,setup:e=>(e,t)=>e.disabled?b(e.$slots,"default",{key:0}):(F(),k(j,{key:1,to:e.to},[b(e.$slots,"default")],8,["to"]))}),[["__file","teleport.vue"]]));export{Z as E,C as F,te as a,W as b,ee as t};
