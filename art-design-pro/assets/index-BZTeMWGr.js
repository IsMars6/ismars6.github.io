var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,n=(a,t,o)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[t]=o,i=(e,a)=>{for(var t in a||(a={}))s.call(a,t)&&n(e,t,a[t]);if(o)for(var t of o(a))l.call(a,t)&&n(e,t,a[t]);return e},r=(e,o)=>a(e,t(o));import{b_ as c,bk as u,aS as d,a0 as v,ah as f,aj as p,_ as m,d as g,cq as b,cz as y,cA as w,b6 as h,V as k,bF as x,a as C,cB as O,aw as z,c as I,a5 as _,n as S,o as E,b3 as N,G as P,f as $,C as j,z as L,X as T,h as R,g as A,i as B,u as X,k as Y,e as D,j as F,az as M,aa as W,aC as H,F as q,aE as G,a3 as V,l as K,m as Z,cC as U,cD as J,as as Q,cE as ee,cF as ae,D as te,cG as oe,U as se,an as le,br as ne,bE as ie,ae as re,W as ce,b5 as ue,aT as de,b4 as ve,bD as fe,a9 as pe,cH as me}from"./index-IQGo8WxO.js";import{E as ge,a as be}from"./index-CVDCfo3G.js";import{d as ye}from"./debounce-Ce2MWZXC.js";import{u as we}from"./index-BfOxij12.js";import{a as he}from"./scroll-CpQYakkq.js";function ke(e,a,t){var o=!0,s=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return c(t)&&(o="leading"in t?!!t.leading:o,s="trailing"in t?!!t.trailing:s),ye(e,a,{leading:o,maxWait:a,trailing:s})}const xe=v({urlList:{type:f(Array),default:()=>p([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:f(String)}}),Ce={close:()=>!0,switch:e=>d(e),rotate:e=>d(e)},Oe=g({name:"ElImageViewer"});const ze=le(m(g(r(i({},Oe),{props:xe,emits:Ce,setup(e,{expose:a,emit:t}){var o;const s=e,l={CONTAIN:{name:"contain",icon:b(w)},ORIGINAL:{name:"original",icon:b(y)}};let n,c="";const{t:u}=h(),d=k("image-viewer"),{nextZIndex:v}=x(),f=C(),p=C([]),m=O(),g=C(!0),le=C(s.initialIndex),ne=z(l.CONTAIN),ie=C({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),re=C(null!=(o=s.zIndex)?o:v()),ce=I((()=>{const{urlList:e}=s;return e.length<=1})),ue=I((()=>0===le.value)),de=I((()=>le.value===s.urlList.length-1)),ve=I((()=>s.urlList[le.value])),fe=I((()=>[d.e("btn"),d.e("prev"),d.is("disabled",!s.infinite&&ue.value)])),pe=I((()=>[d.e("btn"),d.e("next"),d.is("disabled",!s.infinite&&de.value)])),me=I((()=>{const{scale:e,deg:a,offsetX:t,offsetY:o,enableTransition:s}=ie.value;let n=t/e,i=o/e;const r=a*Math.PI/180,c=Math.cos(r),u=Math.sin(r);n=n*c+i*u,i=i*c-t/e*u;const d={transform:`scale(${e}) rotate(${a}deg) translate(${n}px, ${i}px)`,transition:s?"transform .3s":""};return ne.value.name===l.CONTAIN.name&&(d.maxWidth=d.maxHeight="100%"),d})),ye=I((()=>`${le.value+1} / ${s.urlList.length}`));function we(){m.stop(),null==n||n(),document.body.style.overflow=c,t("close")}function he(){g.value=!1}function xe(e){g.value=!1,e.target.alt=u("el.image.error")}function Ce(e){if(g.value||0!==e.button||!f.value)return;ie.value.enableTransition=!1;const{offsetX:a,offsetY:t}=ie.value,o=e.pageX,s=e.pageY,l=ke((e=>{ie.value=r(i({},ie.value),{offsetX:a+e.pageX-o,offsetY:t+e.pageY-s})})),n=N(document,"mousemove",l);N(document,"mouseup",(()=>{n()})),e.preventDefault()}function Oe(){ie.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function ze(){if(g.value)return;const e=oe(l),a=Object.values(l),t=ne.value.name,o=(a.findIndex((e=>e.name===t))+1)%e.length;ne.value=l[e[o]],Oe()}function Ie(e){const a=s.urlList.length;le.value=(e+a)%a}function _e(){ue.value&&!s.infinite||Ie(le.value-1)}function Se(){de.value&&!s.infinite||Ie(le.value+1)}function Ee(e,a={}){if(g.value)return;const{minScale:o,maxScale:l}=s,{zoomRate:n,rotateDeg:r,enableTransition:c}=i({zoomRate:s.zoomRate,rotateDeg:90,enableTransition:!0},a);switch(e){case"zoomOut":ie.value.scale>o&&(ie.value.scale=Number.parseFloat((ie.value.scale/n).toFixed(3)));break;case"zoomIn":ie.value.scale<l&&(ie.value.scale=Number.parseFloat((ie.value.scale*n).toFixed(3)));break;case"clockwise":ie.value.deg+=r,t("rotate",ie.value.deg);break;case"anticlockwise":ie.value.deg-=r,t("rotate",ie.value.deg)}ie.value.enableTransition=c}function Ne(e){var a;"pointer"===(null==(a=e.detail)?void 0:a.focusReason)&&e.preventDefault()}function Pe(){s.closeOnPressEscape&&we()}function $e(e){if(e.ctrlKey)return e.deltaY<0||e.deltaY>0?(e.preventDefault(),!1):void 0}return _(ve,(()=>{S((()=>{const e=p.value[0];(null==e?void 0:e.complete)||(g.value=!0)}))})),_(le,(e=>{Oe(),t("switch",e)})),E((()=>{!function(){const e=ke((e=>{switch(e.code){case se.esc:s.closeOnPressEscape&&we();break;case se.space:ze();break;case se.left:_e();break;case se.up:Ee("zoomIn");break;case se.right:Se();break;case se.down:Ee("zoomOut")}})),a=ke((e=>{Ee((e.deltaY||e.deltaX)<0?"zoomIn":"zoomOut",{zoomRate:s.zoomRate,enableTransition:!1})}));m.run((()=>{N(document,"keydown",e),N(document,"wheel",a)}))}(),n=N("wheel",$e,{passive:!1}),c=document.body.style.overflow,document.body.style.overflow="hidden"})),a({setActiveItem:Ie}),(e,a)=>($(),P(X(be),{to:"body",disabled:!e.teleported},{default:j((()=>[L(T,{name:"viewer-fade",appear:""},{default:j((()=>[R("div",{ref_key:"wrapper",ref:f,tabindex:-1,class:B(X(d).e("wrapper")),style:A({zIndex:re.value})},[L(X(ge),{loop:"",trapped:"","focus-trap-el":f.value,"focus-start-el":"container",onFocusoutPrevented:Ne,onReleaseRequested:Pe},{default:j((()=>[R("div",{class:B(X(d).e("mask")),onClick:M((a=>e.hideOnClickModal&&we()),["self"])},null,10,["onClick"]),Y(" CLOSE "),R("span",{class:B([X(d).e("btn"),X(d).e("close")]),onClick:we},[L(X(W),null,{default:j((()=>[L(X(H))])),_:1})],2),Y(" ARROW "),X(ce)?Y("v-if",!0):($(),D(q,{key:0},[R("span",{class:B(X(fe)),onClick:_e},[L(X(W),null,{default:j((()=>[L(X(G))])),_:1})],2),R("span",{class:B(X(pe)),onClick:Se},[L(X(W),null,{default:j((()=>[L(X(V))])),_:1})],2)],64)),e.$slots.progress||e.showProgress?($(),D("div",{key:1,class:B([X(d).e("btn"),X(d).e("progress")])},[F(e.$slots,"progress",{activeIndex:le.value,total:e.urlList.length},(()=>[K(Z(X(ye)),1)]))],2)):Y("v-if",!0),Y(" ACTIONS "),R("div",{class:B([X(d).e("btn"),X(d).e("actions")])},[R("div",{class:B(X(d).e("actions__inner"))},[F(e.$slots,"toolbar",{actions:Ee,prev:_e,next:Se,reset:ze,activeIndex:le.value,setActiveItem:Ie},(()=>[L(X(W),{onClick:e=>Ee("zoomOut")},{default:j((()=>[L(X(U))])),_:1},8,["onClick"]),L(X(W),{onClick:e=>Ee("zoomIn")},{default:j((()=>[L(X(J))])),_:1},8,["onClick"]),R("i",{class:B(X(d).e("actions__divider"))},null,2),L(X(W),{onClick:ze},{default:j((()=>[($(),P(Q(X(ne).icon)))])),_:1}),R("i",{class:B(X(d).e("actions__divider"))},null,2),L(X(W),{onClick:e=>Ee("anticlockwise")},{default:j((()=>[L(X(ee))])),_:1},8,["onClick"]),L(X(W),{onClick:e=>Ee("clockwise")},{default:j((()=>[L(X(ae))])),_:1},8,["onClick"])]))],2)],2),Y(" CANVAS "),R("div",{class:B(X(d).e("canvas"))},[($(!0),D(q,null,te(e.urlList,((a,t)=>($(),D(q,{key:t},[t===le.value?($(),D("img",{key:0,ref_for:!0,ref:e=>p.value[t]=e,src:a,style:A(X(me)),class:B(X(d).e("img")),crossorigin:e.crossorigin,onLoad:he,onError:xe,onMousedown:Ce},null,46,["src","crossorigin"])):Y("v-if",!0)],64)))),128))],2),F(e.$slots,"default")])),_:3},8,["focus-trap-el"])],6)])),_:3})])),_:3},8,["disabled"]))}})),[["__file","image-viewer.vue"]])),Ie=v({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:f([String,Object])},previewSrcList:{type:f(Array),default:()=>p([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:f(String)}}),_e={load:e=>e instanceof Event,error:e=>e instanceof Event,switch:e=>d(e),close:()=>!0,show:()=>!0},Se=g({name:"ElImage",inheritAttrs:!1});const Ee=le(m(g(r(i({},Se),{props:Ie,emits:_e,setup(e,{expose:a,emit:t}){const o=e,{t:s}=h(),l=k("image"),n=ne(),i=I((()=>ie(Object.entries(n).filter((([e])=>/^(data-|on[A-Z])/i.test(e)||["id","style"].includes(e)))))),r=we({excludeListeners:!0,excludeKeys:I((()=>Object.keys(i.value)))}),c=C(),d=C(!1),v=C(!0),f=C(!1),p=C(),m=C(),g=u&&"loading"in HTMLImageElement.prototype;let b;const y=I((()=>[l.e("inner"),x.value&&l.e("preview"),v.value&&l.is("loading")])),w=I((()=>{const{fit:e}=o;return u&&e?{objectFit:e}:{}})),x=I((()=>{const{previewSrcList:e}=o;return re(e)&&e.length>0})),O=I((()=>{const{previewSrcList:e,initialIndex:a}=o;let t=a;return a>e.length-1&&(t=0),t})),z=I((()=>"eager"!==o.loading&&(!g&&"lazy"===o.loading||o.lazy))),L=()=>{u&&(v.value=!0,d.value=!1,c.value=o.src)};function T(e){v.value=!1,d.value=!1,t("load",e)}function A(e){v.value=!1,d.value=!0,t("error",e)}function M(){((e,a)=>{if(!u||!e||!a)return!1;const t=e.getBoundingClientRect();let o;return o=a instanceof Element?a.getBoundingClientRect():{top:0,right:window.innerWidth,bottom:window.innerHeight,left:0},t.top<o.bottom&&t.bottom>o.top&&t.right>o.left&&t.left<o.right})(p.value,m.value)&&(L(),G())}const W=me(M,200,!0);function H(){return e=this,a=null,t=function*(){var e;if(!u)return;yield S();const{scrollContainer:a}=o;fe(a)?m.value=a:pe(a)&&""!==a?m.value=null!=(e=document.querySelector(a))?e:void 0:p.value&&(m.value=he(p.value)),m.value&&(b=N(m,"scroll",W),setTimeout((()=>M()),100))},new Promise(((o,s)=>{var l=e=>{try{i(t.next(e))}catch(a){s(a)}},n=e=>{try{i(t.throw(e))}catch(a){s(a)}},i=e=>e.done?o(e.value):Promise.resolve(e.value).then(l,n);i((t=t.apply(e,a)).next())}));var e,a,t}function G(){u&&m.value&&W&&(null==b||b(),m.value=void 0)}function V(){x.value&&(f.value=!0,t("show"))}function K(){f.value=!1,t("close")}function U(e){t("switch",e)}return _((()=>o.src),(()=>{z.value?(v.value=!0,d.value=!1,G(),H()):L()})),E((()=>{z.value?H():L()})),a({showPreview:V}),(e,a)=>($(),D("div",ce({ref_key:"container",ref:p},X(i),{class:[X(l).b(),e.$attrs.class]}),[d.value?F(e.$slots,"error",{key:0},(()=>[R("div",{class:B(X(l).e("error"))},Z(X(s)("el.image.error")),3)])):($(),D(q,{key:1},[void 0!==c.value?($(),D("img",ce({key:0},X(r),{src:c.value,loading:e.loading,style:X(w),class:X(y),crossorigin:e.crossorigin,onClick:V,onLoad:T,onError:A}),null,16,["src","loading","crossorigin"])):Y("v-if",!0),v.value?($(),D("div",{key:1,class:B(X(l).e("wrapper"))},[F(e.$slots,"placeholder",{},(()=>[R("div",{class:B(X(l).e("placeholder"))},null,2)]))],2)):Y("v-if",!0)],64)),X(x)?($(),D(q,{key:2},[f.value?($(),P(X(ze),{key:0,"z-index":e.zIndex,"initial-index":X(O),infinite:e.infinite,"zoom-rate":e.zoomRate,"min-scale":e.minScale,"max-scale":e.maxScale,"show-progress":e.showProgress,"url-list":e.previewSrcList,crossorigin:e.crossorigin,"hide-on-click-modal":e.hideOnClickModal,teleported:e.previewTeleported,"close-on-press-escape":e.closeOnPressEscape,onClose:K,onSwitch:U},ue({toolbar:j((a=>[F(e.$slots,"toolbar",de(ve(a)))])),default:j((()=>[e.$slots.viewer?($(),D("div",{key:0},[F(e.$slots,"viewer")])):Y("v-if",!0)])),_:2},[e.$slots.progress?{name:"progress",fn:j((a=>[F(e.$slots,"progress",de(ve(a)))]))}:void 0]),1032,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","show-progress","url-list","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):Y("v-if",!0)],64)):Y("v-if",!0)],16))}})),[["__file","image.vue"]]));export{Ee as E};
