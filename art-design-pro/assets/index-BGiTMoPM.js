var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,o=(a,t,i)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[t]=i,s=(e,a,t)=>o(e,"symbol"!=typeof a?a+"":a,t),n=(e,a,t)=>new Promise(((i,r)=>{var l=e=>{try{s(t.next(e))}catch(a){r(a)}},o=e=>{try{s(t.throw(e))}catch(a){r(a)}},s=e=>e.done?i(e.value):Promise.resolve(e.value).then(l,o);s((t=t.apply(e,a)).next())}));import{g as c}from"./index-9J3W-hCL.js";import{d as h,a as v,o as u,aJ as I,aA as g,e as d,f as p,dr as E,dB as m}from"./index-IQGo8WxO.js";import{b as P}from"./hb-DcPUfgty.js";import{_ as S}from"./_plugin-vue_export-helper-BCo6x5W8.js";const f=h((O=((e,a)=>{for(var t in a||(a={}))r.call(a,t)&&o(e,t,a[t]);if(i)for(var t of i(a))l.call(a,t)&&o(e,t,a[t]);return e})({},{name:"ArtFireworksEffect"}),a(O,t({__name:"index",setup(e){const a={POOL_SIZE:600,PARTICLES_PER_BURST:200,SIZES:{RECTANGLE:{WIDTH:24,HEIGHT:12},SQUARE:{SIZE:12},CIRCLE:{SIZE:12},TRIANGLE:{SIZE:10},OVAL:{WIDTH:24,HEIGHT:12},IMAGE:{WIDTH:30,HEIGHT:30}},ROTATION:{BASE_SPEED:2,RANDOM_SPEED:3,DECAY:.98},PHYSICS:{GRAVITY:.525,VELOCITY_THRESHOLD:10,OPACITY_DECAY:.02},COLORS:["rgba(255, 68, 68, 1)","rgba(255, 68, 68, 0.9)","rgba(255, 68, 68, 0.8)","rgba(255, 116, 188, 1)","rgba(255, 116, 188, 0.9)","rgba(255, 116, 188, 0.8)","rgba(68, 68, 255, 0.8)","rgba(92, 202, 56, 0.7)","rgba(255, 68, 255, 0.8)","rgba(68, 255, 255, 0.7)","rgba(255, 136, 68, 0.7)","rgba(68, 136, 255, 1)","rgba(250, 198, 122, 0.8)"],SHAPES:["rectangle","rectangle","rectangle","rectangle","rectangle","rectangle","rectangle","circle","triangle","oval"]},t=v(),i=v(null),r=new class{constructor(){s(this,"particlePool",[]),s(this,"activeParticles",[]),s(this,"poolIndex",0),s(this,"imageCache",{}),s(this,"animationId",0),s(this,"canvasWidth",0),s(this,"canvasHeight",0),s(this,"animate",(()=>{this.updateParticles(),this.render(),this.animationId=requestAnimationFrame(this.animate)})),this.initializePool()}initializePool(){for(let e=0;e<a.POOL_SIZE;e++)this.particlePool.push(this.createParticle())}createParticle(){return{x:0,y:0,vx:0,vy:0,color:"",rotation:0,rotationSpeed:0,scale:1,shape:"circle",opacity:1,active:!1}}getAvailableParticle(){for(let e=0;e<a.POOL_SIZE;e++){const t=(this.poolIndex+e)%a.POOL_SIZE,i=this.particlePool[t];if(!i.active)return this.poolIndex=(t+1)%a.POOL_SIZE,i.active=!0,i}return null}preloadImage(e){return n(this,null,(function*(){return this.imageCache[e]?this.imageCache[e]:new Promise(((a,t)=>{const i=new Image;i.crossOrigin="anonymous",i.onload=()=>{this.imageCache[e]=i,a(i)},i.onerror=t,i.src=e}))}))}preloadAllImages(){return n(this,null,(function*(){const e=[P,E,m];try{yield Promise.all(e.map((e=>this.preloadImage(e))))}catch(a){}}))}createFirework(e){const t=Math.random()*this.canvasWidth,i=this.canvasHeight,r=e&&this.imageCache[e]?["image"]:a.SHAPES,l=[];for(let o=0;o<a.PARTICLES_PER_BURST;o++){const s=this.getAvailableParticle();if(!s)continue;const n=Math.PI*o/(a.PARTICLES_PER_BURST/2),c=1.5*(12+6*Math.random()),h=Math.random()*Math.PI*2;s.x=t,s.y=i,s.vx=Math.cos(n)*Math.cos(h)*c*(.5*Math.random()+.5),s.vy=Math.sin(n)*c-15,s.color=a.COLORS[Math.floor(Math.random()*a.COLORS.length)],s.rotation=360*Math.random(),s.rotationSpeed=(Math.random()*a.ROTATION.RANDOM_SPEED+a.ROTATION.BASE_SPEED)*(Math.random()>.5?1:-1),s.scale=.8+.4*Math.random(),s.shape=r[Math.floor(Math.random()*r.length)],s.opacity=1,s.imageUrl=e&&this.imageCache[e]?e:void 0,l.push(s)}this.activeParticles.push(...l)}updateParticles(){const{GRAVITY:e,VELOCITY_THRESHOLD:t,OPACITY_DECAY:i}=a.PHYSICS,{DECAY:r}=a.ROTATION;for(let a=this.activeParticles.length-1;a>=0;a--){const l=this.activeParticles[a];l.x+=l.vx,l.y+=l.vy,l.vy+=e,l.rotation+=l.rotationSpeed,l.rotationSpeed*=r,(l.vy>t&&(l.opacity-=i,l.opacity<=0)||this.isOutOfBounds(l))&&this.recycleParticle(a)}}recycleParticle(e){this.activeParticles[e].active=!1,this.activeParticles.splice(e,1)}isOutOfBounds(e){return e.x<-100||e.x>this.canvasWidth+100||e.y<-100||e.y>this.canvasHeight+100}drawParticle(e){i.value&&(i.value.save(),i.value.globalAlpha=e.opacity,i.value.translate(e.x,e.y),i.value.rotate(e.rotation*Math.PI/180),i.value.scale(e.scale,e.scale),this.renderShape(e),i.value.restore())}renderShape(e){if(!i.value)return;const{SIZES:t}=a;switch(i.value.fillStyle=e.color,e.shape){case"rectangle":i.value.fillRect(-12,-6,t.RECTANGLE.WIDTH,t.RECTANGLE.HEIGHT);break;case"square":i.value.fillRect(-6,-6,t.SQUARE.SIZE,t.SQUARE.SIZE);break;case"circle":i.value.beginPath(),i.value.arc(0,0,t.CIRCLE.SIZE/2,0,2*Math.PI),i.value.fill();break;case"triangle":i.value.beginPath(),i.value.moveTo(0,-10),i.value.lineTo(t.TRIANGLE.SIZE,t.TRIANGLE.SIZE),i.value.lineTo(-10,t.TRIANGLE.SIZE),i.value.closePath(),i.value.fill();break;case"oval":i.value.beginPath(),i.value.ellipse(0,0,t.OVAL.WIDTH/2,t.OVAL.HEIGHT/2,0,0,2*Math.PI),i.value.fill();break;case"image":this.renderImage(e)}}renderImage(e){if(!i.value||!e.imageUrl)return;const t=this.imageCache[e.imageUrl];if(null==t?void 0:t.complete){const{WIDTH:e,HEIGHT:r}=a.SIZES.IMAGE;i.value.drawImage(t,-15,-15,e,r)}}render(){if(i.value&&t.value){i.value.clearRect(0,0,this.canvasWidth,this.canvasHeight),i.value.globalCompositeOperation="lighter";for(const e of this.activeParticles)this.drawParticle(e)}}updateCanvasSize(e,a){this.canvasWidth=e,this.canvasHeight=a}start(){this.animate()}stop(){this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=0)}getActiveParticleCount(){return this.activeParticles.length}},l=e=>{(e.ctrlKey&&e.shiftKey&&"p"===e.key.toLowerCase()||e.metaKey&&e.shiftKey&&"p"===e.key.toLowerCase())&&(e.preventDefault(),r.createFirework())},o=()=>{if(!t.value)return;const{innerWidth:e,innerHeight:a}=window;t.value.width=e,t.value.height=a,r.updateCanvasSize(e,a)},h=e=>{const a=e;r.createFirework(a)};return u((()=>n(this,null,(function*(){t.value&&(i.value=t.value.getContext("2d"),i.value&&(o(),yield r.preloadAllImages(),r.start(),c(window,"keydown",l),c(window,"resize",o),I.on("triggerFireworks",h)))})))),g((()=>{r.stop(),I.off("triggerFireworks",h)})),(e,a)=>(p(),d("canvas",{ref_key:"canvasRef",ref:t,class:"layout-fireworks"},null,512))}}))));var O;const A=S(f,[["__scopeId","data-v-9d071477"]]);export{A as default};
