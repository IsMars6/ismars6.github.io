var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,r=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,i=(e,a,t)=>new Promise(((l,o)=>{var s=e=>{try{i(t.next(e))}catch(a){o(a)}},r=e=>{try{i(t.throw(e))}catch(a){o(a)}},i=e=>e.done?l(e.value):Promise.resolve(e.value).then(s,r);i((t=t.apply(e,a)).next())}));import{_ as n}from"./index.vue_vue_type_style_index_0_lang-Dnpokrtl.js";import{d,au as u,v as p,a as m,o as c,S as f,aQ as j,a_ as v,aZ as x,e as _,f as y,h,z as b,C as g,I as w,u as E,F as V,D as O,G as P,aa as k,a$ as A,l as D,m as U,O as C}from"./index-IQGo8WxO.js";import{E as I}from"./emojo-Ben6gd8J.js";import{P as M}from"./formEnum-BLgiZVxV.js";import{c as Y}from"./index-9J3W-hCL.js";import{E as q}from"./index-DEh6ra0d.js";import{E as T}from"./index-lwuhUFm2.js";import{E as $,a as z}from"./index-WiBceMwr.js";import{E as S}from"./index-DRTMnRQ8.js";import{E as F,a as G}from"./index-DvdSgfWH.js";import{E as N}from"./index-BQIkdreF.js";import{E as Q}from"./index-CHo-omvL.js";import{E as W}from"./index-BKGyGajh.js";import{_ as Z}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./index-Bi9RLQBv.js";import"./event-BwRzfsZt.js";import"./index-BfOxij12.js";import"./use-form-item-M_69vDeD.js";import"./index-CId84KWp.js";import"./use-form-common-props-AkxMGj96.js";import"./index-jcv93Qxd.js";import"./aria-BWz5Vf1b.js";import"./error-D_Dr4eZ1.js";import"./index-DC4nx5T3.js";import"./index-CVDCfo3G.js";import"./index-CAywqtFc.js";import"./index-CE6ES6Vp.js";import"./token-DWNpOE8r.js";import"./strings-BMKmFQPH.js";import"./castArray-CEnBrsUU.js";import"./isEqual-DovbVL_y.js";import"./_Uint8Array-C6UxRYqY.js";import"./scroll-CpQYakkq.js";import"./debounce-Ce2MWZXC.js";import"./_baseIteratee-BI4Nmsbi.js";import"./index-DBDo8sc3.js";import"./vnode-CPGJC5yZ.js";import"./_baseClone-GChKn-ks.js";import"./_initCloneObject-9acmKUcz.js";import"./index-Do5p4mC9.js";import"./cloneDeep-B9-2UQHO.js";import"./validator-3LCelPuQ.js";import"./index-BI2hd7RK.js";const B={class:"article-edit"},H={class:"editor-wrap"},J={class:"form-wrap"},K={class:"el-top upload-container"},R={key:0,class:"upload-placeholder"},X=["src"],L={style:{display:"flex","justify-content":"flex-end"}},ee=d((ae=((e,a)=>{for(var t in a||(a={}))o.call(a,t)&&r(e,t,a[t]);if(l)for(var t of l(a))s.call(a,t)&&r(e,t,a[t]);return e})({},{name:"ArticlePublish"}),a(ae,t({__name:"index",setup(e){const a=u(),t=p();let{accessToken:l}=t;const o={Authorization:l};let s=M.Add;const r=m(""),d=m(),Z=m(),ee=m(""),ae=m(""),te=m(""),le=m(!0);c((()=>{f().scrollToTop(),ie(),oe()}));const oe=()=>{const{id:e}=a.query;s=e?M.Edit:M.Add,s===M.Edit&&e?se():re()},se=()=>{ne()},re=()=>{ae.value=ue(Y().value)},ie=()=>i(this,null,(function*(){try{const e=yield j.get("https://www.qiniu.lingchen.kim/classify.json");200===e.data.code&&(Z.value=e.data.data)}catch(e){}})),ne=()=>i(this,null,(function*(){const e=yield j.get("https://www.qiniu.lingchen.kim/blog_list.json");if(e.data.code===v.success){let{title:a,blog_class:t,html_content:l}=e.data.data;r.value=a,d.value=Number(t),ee.value=l}})),de=()=>{s===M.Edit?ce():me()},ue=e=>x(e,"YYYY-MM-DD").value,pe=()=>r.value?d.value?"<p><br></p>"===ee.value?(C.error("请输入文章内容"),!1):!!te.value||(C.error("请上传图片"),!1):(C.error("请选择文章类型"),!1):(C.error("请输入文章标题"),!1),me=()=>i(this,null,(function*(){try{if(!pe())return;ee.value=fe(ee.value)}catch(e){}})),ce=()=>i(this,null,(function*(){try{if(!pe())return;ee.value=fe(ee.value)}catch(e){}})),fe=e=>e.replace(/(\s*)<\/code>/g,"</code>"),je=e=>{te.value=e.data.url,C.success(`图片上传成功 ${I[200]}`)},ve=()=>{C.error(`图片上传失败 ${I[500]}`)},xe=e=>{const a=e.type.startsWith("image/"),t=e.size/1024/1024<2;return a?!!t||(C.error("图片大小不能超过 2MB!"),!1):(C.error("只能上传图片文件!"),!1)};return(e,a)=>{const t=T,l=q,i=z,u=$,p=S,m=n,c=k,f=N,j=F,v=Q,x=G,C=W;return y(),_("div",B,[h("div",null,[h("div",H,[b(p,{gutter:10},{default:g((()=>[b(l,{span:18},{default:g((()=>[b(t,{modelValue:E(r),"onUpdate:modelValue":a[0]||(a[0]=e=>w(r)?r.value=e:null),modelModifiers:{trim:!0},placeholder:"请输入文章标题（最多100个字符）",maxlength:"100"},null,8,["modelValue"])])),_:1}),b(l,{span:6},{default:g((()=>[b(u,{modelValue:E(d),"onUpdate:modelValue":a[1]||(a[1]=e=>w(d)?d.value=e:null),placeholder:"请选择文章类型",filterable:""},{default:g((()=>[(y(!0),_(V,null,O(E(Z),(e=>(y(),P(i,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),b(m,{class:"el-top",modelValue:E(ee),"onUpdate:modelValue":a[2]||(a[2]=e=>w(ee)?ee.value=e:null)},null,8,["modelValue"]),h("div",J,[a[6]||(a[6]=h("h2",null,"发布设置",-1)),b(x,null,{default:g((()=>[b(j,{label:"封面"},{default:g((()=>[h("div",K,[b(f,{class:"cover-uploader",action:"https://m1.apifoxmock.com/m1/6400575-6097373-default/api/common/upload",headers:o,"show-file-list":!1,"on-success":je,"on-error":ve,"before-upload":xe},{default:g((()=>[E(te)?(y(),_("img",{key:1,src:E(te),class:"cover-image"},null,8,X)):(y(),_("div",R,[b(c,{class:"upload-icon"},{default:g((()=>[b(E(A))])),_:1}),a[4]||(a[4]=h("div",{class:"upload-text"},"点击上传封面",-1))]))])),_:1}),a[5]||(a[5]=h("div",{class:"el-upload__tip"},"建议尺寸 16:9，jpg/png 格式",-1))])])),_:1}),b(j,{label:"可见"},{default:g((()=>[b(v,{modelValue:E(le),"onUpdate:modelValue":a[3]||(a[3]=e=>w(le)?le.value=e:null)},null,8,["modelValue"])])),_:1})])),_:1}),h("div",L,[b(C,{type:"primary",onClick:de,style:{width:"100px"}},{default:g((()=>[D(U(E(s)===E(M).Edit?"保存":"发布"),1)])),_:1})])])])])])}}}))));var ae;const te=Z(ee,[["__scopeId","data-v-844204ed"]]);export{te as default};
