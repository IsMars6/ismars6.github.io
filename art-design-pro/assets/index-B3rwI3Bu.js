var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,l=(t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,u=(e,t)=>{for(var n in t||(t={}))r.call(t,n)&&l(e,n,t[n]);if(a)for(var n of a(t))o.call(t,n)&&l(e,n,t[n]);return e},i=(e,a)=>t(e,n(a));import{a0 as s,ah as c,ae as f,_ as v,d,c as m,aw as p,a as g,o as h,a5 as x,b,bp as y,e as $,f as w,j as M,g as A,a4 as E,an as B}from"./index-IQGo8WxO.js";const I=s({zIndex:{type:Number,default:9},rotate:{type:Number,default:-22},width:Number,height:Number,image:String,content:{type:c([String,Array]),default:"Element Plus"},font:{type:c(Object)},gap:{type:c(Array),default:()=>[100,100]},offset:{type:c(Array)}});function O(e,t,n=1){const a=document.createElement("canvas"),r=a.getContext("2d"),o=e*n,l=t*n;return a.setAttribute("width",`${o}px`),a.setAttribute("height",`${l}px`),r.save(),[r,a,o,l]}function j(){return function(e,t,n,a,r,o,l,u){const[i,s,c,v]=O(a,r,n);if(e instanceof HTMLImageElement)i.drawImage(e,0,0,c,v);else{const{color:t,fontSize:a,fontStyle:l,fontWeight:u,fontFamily:s,textAlign:v,textBaseline:d}=o,m=Number(a)*n;i.font=`${l} normal ${u} ${m}px/${r}px ${s}`,i.fillStyle=t,i.textAlign=v,i.textBaseline=d;const p=f(e)?e:[e];null==p||p.forEach(((e,t)=>{i.fillText(null!=e?e:"",c/2,t*(m+3*n))}))}const d=Math.PI/180*Number(t),m=Math.max(a,r),[p,g,h]=O(m,m,n);p.translate(h/2,h/2),p.rotate(d),c>0&&v>0&&p.drawImage(s,-c/2,-v/2);let x=0,b=0,y=0,$=0;const w=c/2,M=v/2;[[0-w,0-M],[0+w,0-M],[0+w,0+M],[0-w,0+M]].forEach((([e,t])=>{const[n,a]=function(e,t){return[e*Math.cos(d)-t*Math.sin(d),e*Math.sin(d)+t*Math.cos(d)]}(e,t);x=Math.min(x,n),b=Math.max(b,n),y=Math.min(y,a),$=Math.max($,a)}));const A=x+h/2,E=y+h/2,B=b-x,I=$-y,j=l*n,P=u*n,S=2*(B+j),N=I+P,[k,z]=O(S,N);function T(e=0,t=0){k.drawImage(g,A,E,B,I,e,t,B,I)}return T(),T(B+j,-I/2-P/2),T(B+j,+I/2+P/2),[z.toDataURL(),S/n,N/n]}}const P=d({name:"ElWatermark"});const S=B(v(d(i(u({},P),{props:I,setup(e){const t=e,n={position:"relative"},a=m((()=>{var e,n;return null!=(n=null==(e=t.font)?void 0:e.color)?n:"rgba(0,0,0,.15)"})),r=m((()=>{var e,n;return null!=(n=null==(e=t.font)?void 0:e.fontSize)?n:16})),o=m((()=>{var e,n;return null!=(n=null==(e=t.font)?void 0:e.fontWeight)?n:"normal"})),l=m((()=>{var e,n;return null!=(n=null==(e=t.font)?void 0:e.fontStyle)?n:"normal"})),s=m((()=>{var e,n;return null!=(n=null==(e=t.font)?void 0:e.fontFamily)?n:"sans-serif"})),c=m((()=>{var e,n;return null!=(n=null==(e=t.font)?void 0:e.textAlign)?n:"center"})),v=m((()=>{var e,n;return null!=(n=null==(e=t.font)?void 0:e.textBaseline)?n:"hanging"})),d=m((()=>t.gap[0])),B=m((()=>t.gap[1])),I=m((()=>d.value/2)),O=m((()=>B.value/2)),P=m((()=>{var e,n;return null!=(n=null==(e=t.offset)?void 0:e[0])?n:I.value})),S=m((()=>{var e,n;return null!=(n=null==(e=t.offset)?void 0:e[1])?n:O.value})),N=p(null),k=p(),z=g(!1),T=()=>{k.value&&(k.value.remove(),k.value=void 0)},D=(e,n)=>{var a;N.value&&k.value&&(z.value=!0,k.value.setAttribute("style",function(e){return Object.keys(e).map((t=>`${function(e){return e.replace(/([A-Z])/g,"-$1").toLowerCase()}(t)}: ${e[t]};`)).join(" ")}(i(u({},(()=>{const e={zIndex:t.zIndex,position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:"none",backgroundRepeat:"repeat"};let n=P.value-I.value,a=S.value-O.value;return n>0&&(e.left=`${n}px`,e.width=`calc(100% - ${n}px)`,n=0),a>0&&(e.top=`${a}px`,e.height=`calc(100% - ${a}px)`,a=0),e.backgroundPosition=`${n}px ${a}px`,e})()),{backgroundImage:`url('${e}')`,backgroundSize:`${Math.floor(n)}px`}))),null==(a=N.value)||a.append(k.value),setTimeout((()=>{z.value=!1})))},L=j(),R=()=>{const e=document.createElement("canvas").getContext("2d"),n=t.image,u=t.content,i=t.rotate;if(e){k.value||(k.value=document.createElement("div"));const m=window.devicePixelRatio||1,[p,g]=(e=>{let n=120,a=64;const{image:o,content:l,width:u,height:i,rotate:c}=t;if(!o&&e.measureText){e.font=`${Number(r.value)}px ${s.value}`;const t=f(l)?l:[l];let o=0,u=0;t.forEach((t=>{const{width:n,fontBoundingBoxAscent:a,fontBoundingBoxDescent:r,actualBoundingBoxAscent:l,actualBoundingBoxDescent:i}=e.measureText(t),s=E(a)?l+i:a+r;n>o&&(o=Math.ceil(n)),s>u&&(u=Math.ceil(s))})),n=o,a=u*t.length+3*(t.length-1);const i=Math.PI/180*Number(c);n+=Math.ceil(Math.abs(Math.sin(i)*a)/2)}return[null!=u?u:n,null!=i?i:a]})(e),h=e=>{const[t,n]=L(e||"",i,m,p,g,{color:a.value,fontSize:r.value,fontStyle:l.value,fontWeight:o.value,fontFamily:s.value,textAlign:c.value,textBaseline:v.value},d.value,B.value);D(t,n)};if(n){const e=new Image;e.onload=()=>{h(e)},e.onerror=()=>{h(u)},e.crossOrigin="anonymous",e.referrerPolicy="no-referrer",e.src=n}else h(u)}};h((()=>{R()})),x((()=>t),(()=>{R()}),{deep:!0,flush:"post"}),b((()=>{T()}));return y(N,(e=>{z.value||e.forEach((e=>{((e,t)=>{let n=!1;return e.removedNodes.length&&t&&(n=Array.from(e.removedNodes).includes(t)),"attributes"===e.type&&e.target===t&&(n=!0),n})(e,k.value)&&(T(),R())}))}),{attributes:!0,subtree:!0,childList:!0}),(e,t)=>(w(),$("div",{ref_key:"containerRef",ref:N,style:A([n])},[M(e.$slots,"default")],4))}})),[["__file","watermark.vue"]]));export{S as E};
