var e=Object.defineProperty,l=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,r=(l,a,s)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[a]=s,n=(e,l)=>{for(var a in l||(l={}))t.call(l,a)&&r(e,a,l[a]);if(s)for(var a of s(l))o.call(l,a)&&r(e,a,l[a]);return e},u=(e,s)=>l(e,a(s));import{d as i,w as c,v,s as p,aG as d,a as h,o as f,aJ as m,aA as y,n as g,e as j,f as x,z as w,C as b,u as k,aX as C,I as T,h as _,J as E,F as S,D,i as O,l as A,m as H,aB as L,ab as I,az as V}from"./index-IQGo8WxO.js";import{E as M}from"./index-lwuhUFm2.js";import{E as $}from"./index-CAywqtFc.js";import{E as K}from"./index-DlgK5ZY7.js";import{_ as P}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./index-Bi9RLQBv.js";import"./event-BwRzfsZt.js";import"./index-BfOxij12.js";import"./use-form-item-M_69vDeD.js";import"./index-CId84KWp.js";import"./use-form-common-props-AkxMGj96.js";import"./index-jcv93Qxd.js";import"./aria-BWz5Vf1b.js";import"./error-D_Dr4eZ1.js";import"./index-ClZ4RRhL.js";import"./vnode-CPGJC5yZ.js";import"./scroll-CpQYakkq.js";import"./index-CVDCfo3G.js";import"./use-dialog-HEYsGeDR.js";import"./index-DyKybXYc.js";import"./refs-B-58sHkE.js";import"./index-BI2hd7RK.js";const U={class:"layout-search"},G={class:"result"},J=["onClick","onMouseenter"],R={class:"selected-icon iconfont-sys"},q={class:"history-box"},z={class:"title"},B={class:"history-result"},F=["onClick","onMouseenter"],W=["onClick"],X={class:"dialog-footer"},Y=P(i(u(n({},{name:"ArtGlobalSearch"}),{__name:"index",setup(e){const l=c(),a=v(),{menuList:s}=p(d()),t=h(!1),o=h(""),r=h([]),{searchHistory:i}=p(a),P=h(null),Y=h(0),N=h(0),Q=h(),Z=h(!1);f((()=>{m.on("openSearchDialog",he),document.addEventListener("keydown",ee)})),y((()=>{document.removeEventListener("keydown",ee)}));const ee=e=>{(navigator.platform.toUpperCase().indexOf("MAC")>=0?e.metaKey:e.ctrlKey)&&"k"===e.key.toLowerCase()&&(e.preventDefault(),t.value=!0,le()),t.value&&("ArrowUp"===e.key?(e.preventDefault(),te()):"ArrowDown"===e.key?(e.preventDefault(),oe()):"Enter"===e.key?(e.preventDefault(),ue()):"Escape"===e.key&&(e.preventDefault(),t.value=!1))},le=()=>{setTimeout((()=>{var e;null==(e=P.value)||e.focus()}),100)},ae=e=>{r.value=e?se(s.value,e):[]},se=(e,l)=>{const a=l.toLowerCase(),s=[],t=e=>{var l;if(null==(l=e.meta)?void 0:l.isHide)return;const o=L(e.meta.title).toLowerCase();e.children&&e.children.length>0?e.children.forEach(t):o.includes(a)&&e.path&&s.push(u(n({},e),{children:void 0}))};return e.forEach(t),s},te=()=>{Z.value=!0,o.value?(Y.value=(Y.value-1+r.value.length)%r.value.length,re()):(N.value=(N.value-1+i.value.length)%i.value.length,ne()),setTimeout((()=>{Z.value=!1}),100)},oe=()=>{Z.value=!0,o.value?(Y.value=(Y.value+1)%r.value.length,re()):(N.value=(N.value+1)%i.value.length,ne()),setTimeout((()=>{Z.value=!1}),100)},re=()=>{g((()=>{if(!Q.value||!r.value.length)return;const e=Q.value.wrapRef;if(!e)return;const l=e.querySelectorAll(".result .box");if(!l[Y.value])return;const a=l[Y.value],s=a.offsetHeight,t=e.scrollTop,o=e.clientHeight,n=a.offsetTop,u=n+s;n<t?Q.value.setScrollTop(n):u>t+o&&Q.value.setScrollTop(u-o)}))},ne=()=>{g((()=>{if(!Q.value||!i.value.length)return;const e=Q.value.wrapRef;if(!e)return;const l=e.querySelectorAll(".history-result .box");if(!l[N.value])return;const a=l[N.value],s=a.offsetHeight,t=e.scrollTop,o=e.clientHeight,r=a.offsetTop,n=r+s;r<t?Q.value.setScrollTop(r):n>t+o&&Q.value.setScrollTop(n-o)}))},ue=()=>{o.value&&r.value.length?ve(r.value[Y.value]):!o.value&&i.value.length&&ve(i.value[N.value])},ie=e=>Y.value===e,ce=()=>{Y.value=0},ve=e=>{t.value=!1,de(e),l.push(e.path),o.value="",r.value=[]},pe=()=>{Array.isArray(i.value)&&a.setSearchHistory(i.value)},de=e=>{const l=i.value.findIndex((l=>l.path===e.path));-1!==l?i.value.splice(l,1):i.value.length>=10&&i.value.pop();const a=n({},e);delete a.children,delete a.meta.authList,i.value.unshift(a),pe()},he=()=>{t.value=!0,le()},fe=()=>{o.value="",r.value=[],Y.value=0,N.value=0};return(e,l)=>{const a=M,s=$,n=K;return x(),j("div",U,[w(n,{modelValue:k(t),"onUpdate:modelValue":l[1]||(l[1]=e=>T(t)?t.value=e:null),width:"600","show-close":!1,"lock-scroll":!1,"modal-class":"search-modal",onClose:fe},{footer:b((()=>[_("div",X,[_("div",null,[l[3]||(l[3]=_("i",{class:"iconfont-sys"},"",-1)),_("span",null,H(e.$t("search.selectKeydown")),1)]),_("div",null,[l[4]||(l[4]=_("i",{class:"iconfont-sys"},"",-1)),l[5]||(l[5]=_("i",{class:"iconfont-sys"},"",-1)),_("span",null,H(e.$t("search.switchKeydown")),1)]),_("div",null,[l[6]||(l[6]=_("i",{class:"iconfont-sys esc"},[_("p",null,"ESC")],-1)),_("span",null,H(e.$t("search.exitKeydown")),1)])])])),default:b((()=>[w(a,{modelValue:k(o),"onUpdate:modelValue":l[0]||(l[0]=e=>T(o)?o.value=e:null),modelModifiers:{trim:!0},placeholder:e.$t("search.placeholder"),onInput:ae,onBlur:ce,ref_key:"searchInput",ref:P,"prefix-icon":k(C)},{suffix:b((()=>l[2]||(l[2]=[_("div",{class:"search-keydown"},[_("i",{class:"iconfont-sys"},"")],-1)]))),_:1},8,["modelValue","placeholder","prefix-icon"]),w(s,{class:"search-scrollbar","max-height":"370px",ref_key:"searchResultScrollbar",ref:Q,always:""},{default:b((()=>[E(_("div",G,[(x(!0),j(S,null,D(k(r),((e,l)=>(x(),j("div",{class:"box",key:l},[_("div",{class:O({highlighted:ie(l)}),onClick:l=>ve(e),onMouseenter:e=>(e=>{!Z.value&&o.value&&(Y.value=e)})(l)},[A(H(k(L)(e.meta.title))+" ",1),E(_("i",R,"",512),[[I,ie(l)]])],42,J)])))),128))],512),[[I,k(r).length]]),E(_("div",q,[_("p",z,H(e.$t("search.historyTitle")),1),_("div",B,[(x(!0),j(S,null,D(k(i),((e,l)=>(x(),j("div",{class:O(["box",{highlighted:k(N)===l}]),key:l,onClick:l=>ve(e),onMouseenter:e=>(e=>{Z.value||o.value||(N.value=e)})(l)},[A(H(k(L)(e.meta.title))+" ",1),_("i",{class:"selected-icon iconfont-sys",onClick:V((e=>(e=>{i.value.splice(e,1),pe()})(l)),["stop"])},"",8,W)],42,F)))),128))])],512),[[I,!k(o)&&0===k(r).length&&k(i).length>0]])])),_:1},512)])),_:1},8,["modelValue"])])}}})),[["__scopeId","data-v-c07b9e36"]]);export{Y as default};
