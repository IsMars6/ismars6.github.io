var e=Object.defineProperty,t=Object.defineProperties,i=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,o=(t,i,r)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[i]=r,l=(e,t)=>{for(var i in t||(t={}))a.call(t,i)&&o(e,i,t[i]);if(r)for(var i of r(t))n.call(t,i)&&o(e,i,t[i]);return e},s=(e,t,i)=>new Promise(((r,a)=>{var n=e=>{try{l(i.next(e))}catch(t){a(t)}},o=e=>{try{l(i.throw(e))}catch(t){a(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(n,o);l((i=i.apply(e,t)).next())}));import{_ as u}from"./index-NjuwKTsQ.js";import{_ as m}from"./index-D_a_vnJt.js";import{_ as p}from"./index-Cm0jkZAR.js";import{d,s as c,aG as v,a as h,r as j,c as f,o as x,y,e as b,f as g,z as _,u as k,I as w,C,J as O,k as A,G as B,l as L,m as T,aB as E,n as P,a8 as M,O as D}from"./index-IQGo8WxO.js";import{A as I}from"./index-KDQQz2mx.js";import{u as R}from"./useTableColumns-DkEEMxim.js";import{u as $}from"./useAuth-BJqvMcDs.js";import{_ as U}from"./menu-dialog.vue_vue_type_script_setup_true_lang-CgU1OtUJ.js";import{E as S}from"./index-BKGyGajh.js";import{E as V}from"./index-BSQc1V3V.js";import{E as z}from"./index-CE6ES6Vp.js";import{E as G}from"./index-BZ7jpfoU.js";import{_ as J}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./formEnum-BLgiZVxV.js";import"./index-9J3W-hCL.js";import"./index-CGps8DB8.js";import"./index-CAywqtFc.js";import"./error-D_Dr4eZ1.js";import"./index-Bi9RLQBv.js";import"./index-DC4nx5T3.js";import"./index-CVDCfo3G.js";import"./aria-BWz5Vf1b.js";import"./index-CId84KWp.js";import"./use-form-common-props-AkxMGj96.js";import"./_Uint8Array-C6UxRYqY.js";import"./_initCloneObject-9acmKUcz.js";import"./isArrayLikeObject-hcJDj58x.js";import"./isPlainObject-Bv4FPB4y.js";import"./_baseIteratee-BI4Nmsbi.js";import"./isEqual-DovbVL_y.js";import"./castArray-CEnBrsUU.js";import"./debounce-Ce2MWZXC.js";import"./index-6fZG0U-_.js";import"./event-BwRzfsZt.js";import"./use-form-item-M_69vDeD.js";import"./index-BI2hd7RK.js";import"./index-DBDo8sc3.js";import"./index-CbRr1A0z.js";import"./index-D_ZFMFhn.js";import"./index-WiBceMwr.js";import"./token-DWNpOE8r.js";import"./strings-BMKmFQPH.js";import"./index-jcv93Qxd.js";import"./scroll-CpQYakkq.js";import"./vnode-CPGJC5yZ.js";import"./index-lwuhUFm2.js";import"./index-BfOxij12.js";import"./vue-draggable-plus-Ph1K8nJS.js";import"./index-BKZxi3r4.js";import"./refs-B-58sHkE.js";import"./index-Cr0GNYrc.js";import"./index-DRTMnRQ8.js";import"./index-DEh6ra0d.js";import"./index-DvdSgfWH.js";import"./_baseClone-GChKn-ks.js";import"./index-xoN2v133.js";import"./index-bUEe-dxn.js";import"./index-BgexRGDI.js";import"./index-B1KT8ZNG.js";import"./cloneDeep-B9-2UQHO.js";import"./index-BP-4FEep.js";import"./index-Sk3Tdu_Z.js";import"./index-CXRd8D_e.js";import"./index-CHo-omvL.js";import"./validator-3LCelPuQ.js";import"./index-BkZM-mZe.js";import"./iconfont-DPUoc2h2.js";import"./index-DlgK5ZY7.js";import"./index-ClZ4RRhL.js";import"./use-dialog-HEYsGeDR.js";import"./index-DyKybXYc.js";const W={class:"menu-page art-full-height"};var Z;const q=J(d((Z=l({},{name:"Menus"}),t(Z,i({__name:"index",setup(e){const{hasAuth:t}=$(),{menuList:i}=c(v()),r=h(!1),a=h(!1),n=h(),o=h(!1),d=h("menu"),J=h(null),Z=h(!1),q={name:"",route:""},K=j(l({},q)),X=j(l({},q)),Y=f((()=>[{label:"菜单名称",key:"name",type:"input",props:{clearable:!0}},{label:"路由地址",key:"route",type:"input",props:{clearable:!0}}])),F=e=>{var t,i,r,a,n;return(null==(t=e.meta)?void 0:t.isAuthButton)?"danger":(null==(i=e.children)?void 0:i.length)?"info":(null==(r=e.meta)?void 0:r.link)&&(null==(a=e.meta)?void 0:a.isIframe)?"success":e.path?"primary":(null==(n=e.meta)?void 0:n.link)?"warning":"info"},{columnChecks:H,columns:N}=R((()=>[{prop:"meta.title",label:"菜单名称",minWidth:120,formatter:e=>{var t;return E(null==(t=e.meta)?void 0:t.title)}},{prop:"type",label:"菜单类型",formatter:e=>M(z,{type:F(e)},(()=>(e=>{var t,i,r,a,n;return(null==(t=e.meta)?void 0:t.isAuthButton)?"按钮":(null==(i=e.children)?void 0:i.length)?"目录":(null==(r=e.meta)?void 0:r.link)&&(null==(a=e.meta)?void 0:a.isIframe)?"内嵌":e.path?"菜单":(null==(n=e.meta)?void 0:n.link)?"外链":"未知"})(e)))},{prop:"path",label:"路由",formatter:e=>{var t,i;return(null==(t=e.meta)?void 0:t.isAuthButton)?"":(null==(i=e.meta)?void 0:i.link)||e.path||""}},{prop:"meta.authList",label:"权限标识",formatter:e=>{var t,i,r,a;return(null==(t=e.meta)?void 0:t.isAuthButton)?(null==(i=e.meta)?void 0:i.authMark)||"":(null==(a=null==(r=e.meta)?void 0:r.authList)?void 0:a.length)?`${e.meta.authList.length} 个权限标识`:""}},{prop:"date",label:"编辑时间",formatter:()=>"2022-3-12 12:00:00"},{prop:"status",label:"状态",formatter:()=>M(z,{type:"success"},(()=>"启用"))},{prop:"operation",label:"操作",width:180,align:"right",formatter:e=>{var t;const i={style:"text-align: right"};return(null==(t=e.meta)?void 0:t.isAuthButton)?M("div",i,[M(I,{type:"edit",onClick:()=>pe(e)}),M(I,{type:"delete",onClick:()=>ve()})]):M("div",i,[M(I,{type:"add",onClick:()=>ue(),title:"新增权限"}),M(I,{type:"edit",onClick:()=>me(e)}),M(I,{type:"delete",onClick:()=>ce()})])}}])),Q=h([]),ee=()=>{Object.assign(K,l({},q)),Object.assign(X,l({},q)),re()},te=()=>{Object.assign(X,l({},K)),re()},ie=()=>{re()},re=()=>{r.value=!0,setTimeout((()=>{Q.value=i.value,r.value=!1}),500)},ae=e=>{if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return new Date(e);if(Array.isArray(e))return e.map((e=>ae(e)));const t={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=ae(e[i]));return t},ne=e=>e.map((e=>{var t,i,r,a;const n=ae(e);if((null==(t=n.children)?void 0:t.length)&&(n.children=ne(n.children)),null==(r=null==(i=e.meta)?void 0:i.authList)?void 0:r.length){const t=e.meta.authList.map((t=>({path:`${e.path}_auth_${t.authMark}`,name:`${String(e.name)}_auth_${t.authMark}`,meta:{title:t.title,authMark:t.authMark,isAuthButton:!0,parentPath:e.path}})));n.children=(null==(a=n.children)?void 0:a.length)?[...n.children,...t]:t}return n})),oe=e=>{var t,i,r,a;const n=[];for(const o of e){const e=(null==(t=X.name)?void 0:t.toLowerCase().trim())||"",l=(null==(i=X.route)?void 0:i.toLowerCase().trim())||"",s=E((null==(r=o.meta)?void 0:r.title)||"").toLowerCase(),u=(o.path||"").toLowerCase(),m=!e||s.includes(e),p=!l||u.includes(l);if(null==(a=o.children)?void 0:a.length){const e=oe(o.children);if(e.length>0){const t=ae(o);t.children=e,n.push(t);continue}}m&&p&&n.push(ae(o))}return n},le=f((()=>{const e=oe(Q.value);return ne(e)})),se=()=>{d.value="menu",J.value=null,Z.value=!0,o.value=!0},ue=()=>{d.value="menu",J.value=null,Z.value=!1,o.value=!0},me=e=>{d.value="menu",J.value=e,Z.value=!0,o.value=!0},pe=e=>{var t,i;d.value="button",J.value={title:null==(t=e.meta)?void 0:t.title,authMark:null==(i=e.meta)?void 0:i.authMark},Z.value=!1,o.value=!0},de=e=>{re()},ce=()=>s(this,null,(function*(){try{yield G.confirm("确定要删除该菜单吗？删除后无法恢复","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),D.success("删除成功"),re()}catch(e){"cancel"!==e&&D.error("删除失败")}})),ve=()=>s(this,null,(function*(){try{yield G.confirm("确定要删除该权限吗？删除后无法恢复","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),D.success("删除成功"),re()}catch(e){"cancel"!==e&&D.error("删除失败")}})),he=()=>{a.value=!a.value,P((()=>{var e;if((null==(e=n.value)?void 0:e.elTableRef)&&le.value){const e=t=>{t.forEach((t=>{var i;(null==(i=t.children)?void 0:i.length)&&(n.value.elTableRef.toggleRowExpansion(t,a.value),e(t.children))}))};e(le.value)}}))};return x((()=>{re()})),(e,i)=>{const l=p,s=S,c=m,v=u,h=V,j=y("auth"),f=y("ripple");return g(),b("div",W,[_(l,{modelValue:k(K),"onUpdate:modelValue":i[0]||(i[0]=e=>w(K)?K.value=e:null),items:k(Y),showExpand:!1,onReset:ee,onSearch:te},null,8,["modelValue","items"]),_(h,{class:"art-table-card",shadow:"never"},{default:C((()=>[_(c,{showZebra:!1,loading:k(r),columns:k(H),"onUpdate:columns":i[1]||(i[1]=e=>w(H)?H.value=e:null),onRefresh:ie},{left:C((()=>[O((g(),B(s,{onClick:se},{default:C((()=>i[3]||(i[3]=[L(" 添加菜单 ")]))),_:1,__:[3]})),[[j,"add"],[f]]),O((g(),B(s,{onClick:he},{default:C((()=>[L(T(k(a)?"收起":"展开"),1)])),_:1})),[[f]]),k(t)("add")?O((g(),B(s,{key:0,onClick:se},{default:C((()=>i[4]||(i[4]=[L(" 添加菜单 ")]))),_:1,__:[4]})),[[f]]):A("",!0)])),_:1},8,["loading","columns"]),_(v,{ref_key:"tableRef",ref:n,rowKey:"path",loading:k(r),columns:k(N),data:k(le),stripe:!1,"tree-props":{children:"children",hasChildren:"hasChildren"},"default-expand-all":!1},null,8,["loading","columns","data"]),_(U,{visible:k(o),"onUpdate:visible":i[2]||(i[2]=e=>w(o)?o.value=e:null),type:k(d),editData:k(J),lockType:k(Z),onSubmit:de},null,8,["visible","type","editData","lockType"])])),_:1})])}}})))),[["__scopeId","data-v-f82d9c8d"]]);export{q as default};
